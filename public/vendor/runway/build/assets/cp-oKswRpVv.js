const ke=window.Vue,{BaseTransition:Kt,BaseTransitionPropsValidators:Xt,Comment:Qt,DeprecationTypes:Zt,EffectScope:Jt,ErrorCodes:Yt,ErrorTypeStrings:$t,Fragment:U,KeepAlive:ei,ReactiveEffect:ti,Static:ii,Suspense:ni,Teleport:si,Text:ri,TrackOpTypes:ai,Transition:li,TransitionGroup:oi,TriggerOpTypes:ui,VueElement:ci,__esModule:di,assertNumber:hi,callWithAsyncErrorHandling:mi,callWithErrorHandling:fi,camelize:vi,capitalize:bi,cloneVNode:gi,compatUtils:pi,compile:yi,computed:V,createApp:ki,createBlock:u,createCommentVNode:c,createElementBlock:S,createElementVNode:P,createHydrationRenderer:Si,createPropsRestProxy:_i,createRenderer:Ci,createSSRApp:wi,createSlots:K,createStaticVNode:Pi,createTextVNode:D,createVNode:s,customRef:xi,defineAsyncComponent:Ti,defineComponent:Ri,defineCustomElement:Ei,defineEmits:Bi,defineExpose:Ai,defineModel:Di,defineOptions:Mi,defineProps:Ii,defineSSRCustomElement:Ui,defineSlots:Hi,devtools:Li,effect:Vi,effectScope:Oi,getCurrentInstance:Se,getCurrentScope:qi,getCurrentWatcher:Fi,getTransitionRawChildren:zi,guardReactiveProps:ee,h:ji,handleError:Wi,hasInjectionContext:Ni,hydrate:Gi,hydrateOnIdle:Ki,hydrateOnInteraction:Xi,hydrateOnMediaQuery:Qi,hydrateOnVisible:Zi,initCustomFormatter:Ji,initDirectivesForSSR:Yi,inject:$i,isMemoSame:en,isProxy:tn,isReactive:nn,isReadonly:sn,isRef:rn,isRuntimeOnly:an,isShallow:ln,isVNode:on,markRaw:un,mergeDefaults:cn,mergeModels:dn,mergeProps:_e,nextTick:hn,normalizeClass:N,normalizeProps:te,normalizeStyle:mn,onActivated:fn,onBeforeMount:vn,onBeforeUnmount:bn,onBeforeUpdate:gn,onDeactivated:pn,onErrorCaptured:yn,onMounted:kn,onRenderTracked:Sn,onRenderTriggered:_n,onScopeDispose:Cn,onServerPrefetch:wn,onUnmounted:Pn,onUpdated:xn,onWatcherCleanup:Tn,openBlock:a,popScopeId:Rn,provide:En,proxyRefs:Bn,pushScopeId:An,queuePostFlushCb:Dn,reactive:Mn,readonly:In,ref:M,registerRuntimeCompiler:Un,render:Hn,renderList:re,renderSlot:Ce,resolveComponent:o,resolveDirective:we,resolveDynamicComponent:Ln,resolveFilter:Vn,resolveTransitionHooks:On,setBlockTracking:qn,setDevtoolsHook:Fn,setTransitionHooks:zn,shallowReactive:jn,shallowReadonly:Wn,shallowRef:Nn,ssrContextKey:Gn,ssrUtils:Kn,stop:Xn,toDisplayString:w,toHandlerKey:Qn,toHandlers:Zn,toRaw:Jn,toRef:Yn,toRefs:$n,toValue:es,transformVNodeArgs:ts,triggerRef:is,unref:f,useAttrs:ns,useCssModule:ss,useCssVars:rs,useHost:as,useId:ls,useModel:os,useSSRContext:us,useShadowRoot:cs,useSlots:ds,useTemplateRef:hs,useTransitionState:ms,vModelCheckbox:fs,vModelDynamic:vs,vModelRadio:bs,vModelSelect:gs,vModelText:ps,vShow:ys,version:ks,warn:Ss,watch:_s,watchEffect:Cs,watchPostEffect:ws,watchSyncEffect:Ps,withAsyncContext:xs,withCtx:l,withDefaults:Ts,withDirectives:Pe,withKeys:xe,withMemo:Rs,withModifiers:G,withScopeId:Es}=ke,{Form:Bs,Head:X,Link:ae,router:le,toggleArchitecturalBackground:As,useArchitecturalBackground:Ds,useForm:Ms,usePoll:Is}=__STATAMIC__.inertia,{Fieldtype:Us,IndexFieldtype:Hs,FieldtypeMixin:Ls,HasActionsMixin:Te,HasInputOptionsMixin:Vs,HasPreferencesMixin:Re,IndexFieldtypeMixin:Os,InlineEditForm:qs,DateFormatter:Ee,ItemActions:oe,RelatedItem:Be,RestoreRevision:Ae,RevisionHistory:De,RevisionPreview:Me,SaveButtonOptions:Ie,SortableList:Fs,requireElevatedSession:zs,requireElevatedSessionIf:js,clone:ie,deepClone:Ws,resetValuesFromResponse:Ue}=__STATAMIC__.core,{AuthCard:Ns,Avatar:He,Badge:Le,Button:Q,ButtonGroup:Gs,Calendar:Ks,Card:Ve,CardList:Xs,CardListItem:Qs,CardPanel:Oe,CharacterCounter:Zs,Checkbox:Js,CheckboxGroup:Ys,CodeEditor:$s,Combobox:er,CommandPaletteItem:tr,ConfirmationModal:qe,Context:ir,ContextFooter:nr,ContextHeader:sr,ContextItem:rr,ContextLabel:ar,ContextMenu:lr,ContextSeparator:or,CreateForm:ur,DatePicker:Fe,DateRangePicker:cr,Description:dr,DocsCallout:hr,DragHandle:mr,Dropdown:ue,DropdownItem:F,DropdownLabel:ze,DropdownMenu:ce,DropdownSeparator:de,DropdownFooter:fr,DropdownHeader:vr,Editable:br,ErrorMessage:gr,EmptyStateItem:pr,EmptyStateMenu:yr,Field:kr,Header:he,Heading:me,HoverCard:Sr,Icon:Z,Input:_r,InputGroup:Cr,InputGroupAppend:wr,InputGroupPrepend:Pr,Label:xr,Listing:fe,ListingCustomizeColumns:Tr,ListingFilters:Rr,ListingHeaderCell:Er,ListingPagination:je,ListingPresets:Br,ListingPresetTrigger:Ar,ListingRowActions:Dr,ListingSearch:Mr,ListingTable:Ir,ListingTableBody:We,ListingTableHead:Ne,ListingToggleAll:Ur,LivePreview:Ge,LivePreviewPopout:Hr,Modal:Lr,ModalClose:Vr,ModalTitle:Or,Pagination:qr,Panel:Ke,PanelFooter:Fr,PanelHeader:Xe,Popover:zr,PublishComponents:Qe,PublishContainer:Ze,publishContextKey:Je,injectPublishContext:Ye,PublishField:jr,PublishFields:Wr,PublishFieldsProvider:Nr,PublishForm:Gr,PublishLocalizations:$e,PublishSections:Kr,PublishTabs:et,Radio:Xr,RadioGroup:Qr,Select:ve,Separator:Zr,Slider:Jr,Skeleton:Yr,SplitterGroup:$r,SplitterPanel:ea,SplitterResizeHandle:ta,StatusIndicator:z,Subheading:J,Switch:tt,TabContent:ia,Stack:it,StackClose:na,StackHeader:sa,StackFooter:ra,StackContent:aa,Table:la,TableCell:oa,TableColumn:ua,TableColumns:ca,TableRow:da,TableRows:ha,TabList:ma,TabProvider:fa,Tabs:va,TabTrigger:ba,Textarea:nt,TimePicker:ga,ToggleGroup:pa,ToggleItem:ya,Widget:ne,registerIconSet:ka,registerIconSetFromStrings:Sa}=__STATAMIC__.ui,st=["textContent"],rt={__name:"Index",props:{icon:{type:String,required:!0},title:{type:String,required:!0},resource:{type:String,required:!0},canCreate:{type:Boolean,required:!0},createUrl:{type:String,required:!0},createLabel:{type:String,required:!0},columns:{type:Array,required:!0},filters:{type:Array,required:!0},actions:{type:Array,required:!0},actionUrl:{type:String,required:!0},modelsActionUrl:{type:String,required:!0},blueprintUrl:{type:String,required:!0},canEditBlueprint:{type:Boolean,required:!0},hasPublishStates:{type:Boolean,required:!0},titleColumn:{type:String,required:!0}},setup(e){const i=e,t=M(`runway.${i.resource}`),g=M(cp_url(`runway/${i.resource}/listing-api`)),r=M(null),n=M(null),R=M(null);function y({items:v,parameters:p}){r.value=v,n.value=p.page,R.value=p.perPage}return(v,p)=>(a(),S(U,null,[s(f(X),{title:[v.__(e.title)]},null,8,["title"]),P("div",null,[s(f(he),{title:v.__(e.title),icon:e.icon},{default:l(()=>[s(f(oe),{url:e.actionUrl,actions:e.actions,item:e.resource,onStarted:v.actionStarted,onCompleted:v.actionCompleted},{default:l(({actions:h})=>[s(f(ue),{placement:"left-start",class:"me-2"},{default:l(()=>[s(f(ce),null,{default:l(()=>[s(f(ze),{text:v.__("Actions")},null,8,["text"]),e.canEditBlueprint?(a(),u(f(F),{key:0,text:v.__("Edit Blueprint"),icon:"blueprint-edit",href:e.blueprintUrl},null,8,["text","href"])):c("",!0),e.canEditBlueprint&&h.length?(a(),u(f(de),{key:1})):c("",!0),(a(!0),S(U,null,re(h,b=>(a(),u(f(F),{key:b.handle,text:v.__(b.title),icon:b.icon,variant:b.dangerous?"destructive":"default",onClick:b.run},null,8,["text","icon","variant","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:1},8,["url","actions","item","onStarted","onCompleted"]),e.canCreate?(a(),u(f(Q),{key:0,variant:"primary",text:e.createLabel,href:e.createUrl},null,8,["text","href"])):c("",!0)]),_:1},8,["title","icon"]),s(f(fe),{ref:"listing",url:g.value,columns:e.columns,"action-url":e.modelsActionUrl,"action-context":{resource:e.resource},"preferences-prefix":t.value,filters:e.filters,"push-query":"",onRequestCompleted:y},K({[`cell-${e.titleColumn}`]:l(({row:h,isColumnVisible:b})=>[s(f(ae),{class:"title-index-field",href:h.edit_url,onClick:p[0]||(p[0]=G(()=>{},["stop"]))},{default:l(()=>[e.hasPublishStates&&!b("status")?(a(),u(f(z),{key:0,status:h.status},null,8,["status"])):c("",!0),P("span",{textContent:w(h[e.titleColumn])},null,8,st)]),_:2},1032,["href"])]),"prepended-row-actions":l(({row:h})=>[h.viewable&&h.permalink?(a(),u(f(F),{key:0,text:v.__("Visit URL"),href:h.permalink,target:"_blank",icon:"eye"},null,8,["text","href"])):c("",!0),h.editable?(a(),u(f(F),{key:1,text:v.__("Edit"),href:h.edit_url,icon:"edit"},null,8,["text","href"])):c("",!0)]),_:2},[e.hasPublishStates?{name:"cell-status",fn:l(({row:h})=>[s(f(z),{status:h.status,"show-label":"","show-dot":!1},null,8,["status"])]),key:"0"}:void 0]),1032,["url","columns","action-url","action-context","preferences-prefix","filters"])])],64))}},{AfterSaveHooks:at,BeforeSaveHooks:lt,Pipeline:ot,PipelineStopped:ut,Request:ct}=__STATAMIC__.savePipeline,Y=(e,i)=>{const t=e.__vccOpts||e;for(const[g,r]of i)t[g]=r;return t},dt={components:{Heading:me,Button:Q,Select:ve,DatePicker:Fe,Textarea:nt,Icon:Z,Subheading:J},props:{actions:Object,published:Boolean,resourceHandle:String,reference:String,publishContainer:String,canManagePublishState:Boolean},data(){return{action:this.canManagePublishState?"publish":"revision",revisionMessage:null,saving:!1}},computed:{options(){const e=[];return this.canManagePublishState&&(e.push({value:"publish",label:__("Publish Now")}),this.published&&e.push({value:"unpublish",label:__("Unpublish")})),e.push({value:"revision",label:__("Create Revision")}),e},actionInfoText(){switch(this.action){case"publish":return __("messages.publish_actions_publish");case"schedule":return __("messages.publish_actions_schedule");case"unpublish":return __("messages.publish_actions_unpublish");case"revision":return __("messages.publish_actions_create_revision")}},submitButtonText(){return this.options.find(e=>e.value===this.action).label}},methods:{submit(){this.saving=!0,this.$emit("saving");const e="submit"+this.action.charAt(0).toUpperCase()+this.action.substring(1);this[e]()},submitPublish(){this.runBeforePublishHook()},runBeforePublishHook(){Statamic.$hooks.run("runway.publishing",{resource:this.resourceHandle,message:this.revisionMessage}).then(this.performPublishRequest).catch(e=>{this.saving=!1,this.$toast.error(e||__("Something went wrong"))})},performPublishRequest(){const e={message:this.revisionMessage};this.$axios.post(this.actions.publish,e).then(i=>{if(this.saving=!1,!i.data.saved)return this.$emit("failed"),this.$toast.error(__("Couldn't publish entry"));this.$toast.success(__("Published")),this.runAfterPublishHook(i)}).catch(i=>this.handleAxiosError(i))},runAfterPublishHook(e){Statamic.$hooks.run("runway.published",{resource:this.resourceHandle,reference:this.reference,message:this.revisionMessage,response:e}).then(()=>{this.revisionMessage=null,this.$emit("saved",{published:!0,isWorkingCopy:!1,response:e})}).catch(i=>{})},submitSchedule(){},submitUnpublish(){const e={message:this.revisionMessage};this.$axios.post(this.actions.unpublish,{data:e}).then(i=>{if(this.saving=!1,!i.data.saved)return this.$emit("failed"),this.$toast.error(__("Couldn't unpublish entry"));this.$toast.success(__("Unpublished")),this.revisionMessage=null,this.$emit("saved",{published:!1,isWorkingCopy:!1,response:i})}).catch(i=>this.handleAxiosError(i))},submitRevision(){const e={message:this.revisionMessage};this.$axios.post(this.actions.createRevision,e).then(i=>{this.$toast.success(__("Revision created")),this.revisionMessage=null,this.$emit("saved",{isWorkingCopy:!0,response:i})}).catch(i=>this.handleAxiosError(i))},handleAxiosError(e){if(e.response&&e.response.status===422){const{message:i,errors:t}=e.response.data;this.error=i,this.errors=t,this.$toast.error(i),this.$reveal.invalid()}else e.response?this.$toast.error(e.response.data.message):this.$toast.error(e||"Something went wrong");this.saving=!1,this.$emit("failed")}}},ht={class:"m-2 flex h-full flex-col rounded-xl bg-white dark:bg-gray-800"},mt={class:"flex items-center justify-between rounded-t-xl border-b border-gray-300 px-4 mb-3 py-2 dark:border-gray-950 dark:bg-gray-800"},ft={class:"flex-1 overflow-auto"},vt={key:0,class:"loading flex h-full items-center justify-center"},bt={key:1,class:"p-3 flex flex-col space-y-6"},gt={class:"flex"},pt={key:0,class:"flex text-red-600"};function yt(e,i,t,g,r,n){const R=o("Heading"),y=o("Button"),v=o("Icon"),p=o("Select"),h=o("Textarea"),b=o("Subheading"),B=o("stack");return a(),u(B,{narrow:"",name:"publish-options",onClosed:i[2]||(i[2]=H=>e.$emit("closed"))},{default:l(({close:H})=>[P("div",ht,[P("header",mt,[s(R,{size:"lg"},{default:l(()=>[D(w(e.__("Publish")),1)]),_:1}),s(y,{icon:"x",variant:"ghost",class:"-me-2",onClick:H},null,8,["onClick"])]),P("div",ft,[r.saving?(a(),S("div",vt,[s(v,{name:"loading"})])):(a(),S("div",bt,[s(p,{class:"w-full",options:n.options,modelValue:r.action,"onUpdate:modelValue":i[0]||(i[0]=d=>r.action=d)},null,8,["options","modelValue"]),r.action?(a(),S(U,{key:0},[s(h,{class:"text-sm",modelValue:r.revisionMessage,"onUpdate:modelValue":i[1]||(i[1]=d=>r.revisionMessage=d),placeholder:e.__("Notes about this revision"),onKeydown:xe(n.submit,["enter"]),focus:!0},null,8,["modelValue","placeholder","onKeydown"]),s(y,{variant:"primary",text:n.submitButtonText,onClick:n.submit},null,8,["text","onClick"]),P("div",gt,[s(v,{name:"info",class:"size-4 shrink-0 me-2"}),s(b,{size:"sm",class:"flex-1",text:n.actionInfoText},null,8,["text"])]),r.action==="schedule"?(a(),S("div",pt,[s(v,{name:"info",class:"size-4 shrink-0 me-2"}),s(b,{size:"sm",class:"flex-1 text-red-600",text:e.__("messages.publish_actions_current_becomes_draft_because_scheduled")},null,8,["text"])])):c("",!0)],64)):c("",!0)]))])])]),_:1})}const kt=Y(dt,[["render",yt]]),St={components:{RevisionPreview:Me,RestoreRevision:Ae,Subheading:J,Badge:Le,Avatar:He},props:{revision:Object,restoreUrl:String,reference:String,canRestoreRevisions:Boolean,isLast:Boolean},data(){return{showDetails:!1,componentProps:{initialActions:"actions",collectionTitle:"collection.title",collectionUrl:"collection.url",initialTitle:"title",initialReference:"reference",initialBlueprint:"blueprint",initialValues:"values",initialMeta:"meta",initialPublished:"published",initialPermalink:"permalink",initialIsWorkingCopy:"hasWorkingCopy",initialReadOnly:"readOnly",canManagePublishState:"canManagePublishState",resourceHasRoutes:"resourceHasRoutes",resource:"resource"}}},computed:{time(){return Ee.format(this.revision.date*1e3,"time")}},methods:{open(){if(this.revision.action==="working"){this.$emit("working-copy-selected");return}this.showDetails=!0}}},_t={class:"flex gap-3"},Ct={class:"grid gap-1"},wt=["textContent"],Pt={class:"flex items-center gap-1 ml-auto"};function xt(e,i,t,g,r,n){const R=o("Avatar"),y=o("Subheading"),v=o("Badge"),p=o("restore-revision"),h=o("revision-preview"),b=we("tooltip");return Pe((a(),S("div",{class:N(["relative block cursor-pointer space-y-2 px-3 py-2 text-sm hover:[&_.revision-message]:underline",{"status-working-copy":t.revision.action==="working","status-published":t.revision.attributes.published,"border border-ui-accent-bg dark:border-dark-ui-accent-bg/90 rounded-lg py-2.5 bg-[hsl(from_var(--theme-color-ui-accent-bg)_h_s_97)] dark:bg-[hsl(from_var(--theme-color-dark-ui-accent-bg)_h_40_20)]":t.revision.attributes.current,"bg-gradient-to-b from-transparent from-60% to-white dark:to-gray-800 -mt-1":t.isLast}]),onClick:i[1]||(i[1]=(...B)=>n.open&&n.open(...B))},[P("div",_t,[t.revision.user?(a(),u(R,{key:0,user:t.revision.user,class:"size-6 shrink-0 mt-1"},null,8,["user"])):c("",!0),P("div",Ct,[t.revision.message?(a(),S("div",{key:0,class:"revision-message font-medium",textContent:w(t.revision.message)},null,8,wt)):c("",!0),s(y,{class:N(["text-xs text-gray-500! dark:text-gray-400!",{"text-gray-800! dark:text-white!":t.revision.attributes.current}])},{default:l(()=>[D(w(n.time)+" ",1),t.revision.user?(a(),S(U,{key:0},[D(" by "+w(t.revision.user.name||t.revision.user.email),1)],64)):c("",!0)]),_:1},8,["class"])]),P("div",Pt,[s(v,{size:"sm",color:t.revision.action==="working"?"gray":{publish:"green",revision:"gray",restore:"gray",unpublish:"red"}[t.revision.action],text:t.revision.action==="working"?e.__("Working Copy"):{publish:e.__("Published"),revision:e.__("Revision"),restore:e.__("Restored"),unpublish:e.__("Unpublished")}[t.revision.action]},null,8,["color","text"])]),r.showDetails?(a(),u(h,{key:1,revision:t.revision,component:"runway-publish-form","component-props":r.componentProps,onClosed:i[0]||(i[0]=B=>r.showDetails=!1)},{"action-buttons-right":l(()=>[t.canRestoreRevisions?(a(),u(p,{key:0,revision:t.revision,url:t.restoreUrl,reference:t.reference,class:"ltr:ml-4 rtl:mr-4"},null,8,["revision","url","reference"])):c("",!0)]),_:1},8,["revision","component-props"])):c("",!0)])],2)),[[b,t.revision.attributes.current?e.__("Current Revision"):null]])}const Tt=Y(St,[["render",xt]]),Rt={components:{Revision:Tt},mixins:[De]};function Et(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var j={exports:{}},Bt=j.exports,se;function At(){return se||(se=1,function(e){(function(i){if(typeof t!="function"){var t=function(d){return d};t.nonNative=!0}const g=t("plaintext"),r=t("html"),n=t("comment"),R=/<(\w*)>/g,y=/<\/?([^\s\/>]+)/;function v(d,m,E){d=d||"",m=m||[],E=E||"";let I=h(m,E);return b(d,I)}function p(d,m){d=d||[],m=m||"";let E=h(d,m);return function(x){return b(x||"",E)}}v.init_streaming_mode=p;function h(d,m){return d=B(d),{allowable_tags:d,tag_replacement:m,state:g,tag_buffer:"",depth:0,in_quote_char:""}}function b(d,m){if(typeof d!="string")throw new TypeError("'html' parameter must be a string");let E=m.allowable_tags,I=m.tag_replacement,x=m.state,k=m.tag_buffer,L=m.depth,T=m.in_quote_char,A="";for(let O=0,W=d.length;O<W;O++){let _=d[O];if(x===g)switch(_){case"<":x=r,k+=_;break;default:A+=_;break}else if(x===r)switch(_){case"<":if(T)break;L++;break;case">":if(T)break;if(L){L--;break}T="",x=g,k+=">",E.has(H(k))?A+=k:A+=I,k="";break;case'"':case"'":_===T?T="":T=T||_,k+=_;break;case"-":k==="<!-"&&(x=n),k+=_;break;case" ":case`
`:if(k==="<"){x=g,A+="< ",k="";break}k+=_;break;default:k+=_;break}else if(x===n)switch(_){case">":k.slice(-2)=="--"&&(x=g),k="";break;default:k+=_;break}}return m.state=x,m.tag_buffer=k,m.depth=L,m.in_quote_char=T,A}function B(d){let m=new Set;if(typeof d=="string"){let E;for(;E=R.exec(d);)m.add(E[1])}else!t.nonNative&&typeof d[t.iterator]=="function"?m=new Set(d):typeof d.forEach=="function"&&d.forEach(m.add,m);return m}function H(d){let m=y.exec(d);return m?m[1].toLowerCase():null}e.exports?e.exports=v:i.striptags=v})(Bt)}(j)),j.exports}var Dt=At();const Mt=Et(Dt),It={mixins:[Re,Te],components:{Button:Q,Card:Ve,CardPanel:Oe,Dropdown:ue,DropdownItem:F,DropdownMenu:ce,DropdownSeparator:de,Header:he,Heading:me,Icon:Z,ItemActions:oe,LivePreview:Ge,LocalizationsCard:$e,Panel:Ke,PanelHeader:Xe,PublishActions:kt,PublishComponents:Qe,PublishContainer:Ze,PublishTabs:et,RevisionHistory:Rt,SaveButtonOptions:Ie,StatusIndicator:z,Subheading:J,Switch:tt,Select:ve,Stack:it},inject:{publishContext:{from:Je}},props:{publishContainer:String,initialReference:String,initialBlueprint:Object,initialValues:Object,initialMeta:Object,initialTitle:String,initialIsWorkingCopy:Boolean,resource:Object,initialActions:Object,method:String,isCreating:Boolean,isInline:Boolean,initialReadOnly:Boolean,initialStatus:String,initialPermalink:String,revisionsEnabled:Boolean,canEditBlueprint:Boolean,canManagePublishState:Boolean,createAnotherUrl:String,initialListingUrl:String,resourceHasRoutes:Boolean,livePreviewUrl:String,previewTargets:Array},data(){return{actions:this.initialActions,trackDirtyState:!0,blueprint:this.initialBlueprint,title:this.initialTitle,status:this.initialStatus,values:ie(this.initialValues),visibleValues:{},meta:ie(this.initialMeta),isWorkingCopy:this.initialIsWorkingCopy,isPreviewing:!1,tabsVisible:!0,state:"new",revisionMessage:null,showRevisionHistory:null,preferencesPrefix:`runway.${this.resource.handle}`,initialPublished:this.initialValues[this.resource.published_column],confirmingPublish:!1,readOnly:this.initialReadOnly,permalink:this.initialPermalink,saveKeyBinding:null,quickSaveKeyBinding:null,quickSave:!1}},setup(){const e=M(!1),i=M({});return{savingRef:V(()=>e),errorsRef:V(()=>i)}},computed:{containerRef(){return V(()=>this.$refs.container)},saving(){return this.savingRef.value},errors(){return this.errorsRef.value},formattedTitle(){return Mt(__(this.title))},somethingIsLoading(){return!this.$progress.isComplete()},canSave(){return!this.readOnly&&!this.somethingIsLoading},canPublish(){return!(!this.revisionsEnabled||this.readOnly||this.isCreating||this.somethingIsLoading||this.isDirty)},publishStatesEnabled(){return this.resource.has_publish_states},published(){return this.publishStatesEnabled?this.values[this.resource.published_column]:!1},listingUrl(){return`${this.initialListingUrl}`},showLivePreviewButton(){return!this.isCreating&&this.isBase&&this.livePreviewUrl},showVisitUrlButton(){return!!this.permalink},isBase(){return this.publishContainer==="base"},isDirty(){return this.$dirty.has(this.publishContainer)},publishButtonText(){return this.canManagePublishState?`${__("Publish")}…`:`${__("Create Revision")}…`},saveText(){switch(!0){case this.revisionsEnabled:return __("Save Changes");case this.isUnpublishing:return __("Save & Unpublish");case(this.publishStatesEnabled&&this.isDraft):return __("Save Draft");default:return this.publishStatesEnabled?__("Save & Publish"):__("Save")}},isUnpublishing(){return this.publishStatesEnabled?this.initialPublished&&!this.published&&!this.isCreating:!1},isDraft(){return this.publishStatesEnabled?!this.published:!1},afterSaveOption(){return this.getPreference("after_save")},direction(){return this.$config.get("direction","ltr")},parentContainer(){var e;return(e=this.publishContext)==null?void 0:e.parentContainer}},watch:{saving(e){this.$progress.loading(`${this.publishContainer}-runway-publish-form`,e)},title(e){var i;if(this.isBase){const t=this.direction==="ltr"?"‹":"›",g=document.title.split(t);document.title=`${e} ${t} ${(i=g[1])==null?void 0:i.trim()}`}}},methods:{save(){if(!this.canSave){this.quickSave=!1;return}new ot().provide({container:this.containerRef,errors:this.errorsRef,saving:this.savingRef}).through([new lt("runway",{resource:this.resource,values:this.values}),new ct(this.actions.save,this.method),new at("runway",{resource:this.resource,reference:this.initialReference})]).then(e=>{if(this.revisionsEnabled){clearTimeout(this.trackDirtyStateTimeout),this.trackDirtyState=!1,this.values=Ue(e.data.data.values,this.$refs.container),this.trackDirtyStateTimeout=setTimeout(()=>this.trackDirtyState=!0,500),this.$nextTick(()=>this.$emit("saved",e));return}this.title=e.data.data.title,this.status=e.data.data.status,this.isWorkingCopy=!0,this.revisionsEnabled||(this.permalink=e.data.data.permalink),this.isCreating||this.$toast.success(__("Saved"));let i=this.quickSave||this.afterSaveOption;!this.isInline&&i==="create_another"?this.redirectTo(this.createAnotherUrl):!this.isInline&&i===null?this.redirectTo(this.listingUrl):(clearTimeout(this.trackDirtyStateTimeout),this.trackDirtyState=!1,this.trackDirtyStateTimeout=setTimeout(()=>this.trackDirtyState=!0,500),this.initialPublished=e.data.data.published,this.$nextTick(()=>this.$emit("saved",e))),this.quickSave=!1}).catch(e=>{e instanceof ut||(this.$toast.error(__("Something went wrong")),console.error(e))})},confirmPublish(){this.canPublish&&(this.confirmingPublish=!0)},openLivePreview(){this.tabsVisible=!1,this.$wait(200).then(()=>(this.isPreviewing=!0,this.$wait(300))).then(()=>this.tabsVisible=!0)},closeLivePreview(){this.isPreviewing=!1,this.tabsVisible=!0},publishActionCompleted({published:e,isWorkingCopy:i,response:t}){this.saving=!1,e!==void 0&&(this.$refs.container.setFieldValue("published",e),this.initialPublished=e),this.$refs.container.saved(),this.isWorkingCopy=i,this.confirmingPublish=!1,this.title=t.data.data.title,this.status=t.data.data.status,clearTimeout(this.trackDirtyStateTimeout),this.trackDirtyState=!1,this.values=this.resetValuesFromResponse(t.data.data.values),this.trackDirtyStateTimeout=setTimeout(()=>this.trackDirtyState=!0,350),this.permalink=t.data.data.permalink,this.$nextTick(()=>this.$emit("saved",t))},publishActionFailed(){this.confirmPublish=!1,this.saving=!1},setFieldValue(e,i){this.$refs.container.setFieldValue(e,i)},populateBelongsToRelationship(){this.parentContainer&&this.initialBlueprint.tabs.forEach(e=>{e.sections.forEach(i=>{i.fields.filter(t=>t.type==="belongs_to").filter(t=>{let g=this.parentContainer.reference.value.split("::")[1];return t.resource===g}).forEach(t=>{this.values[t.handle].includes(this.parentContainer.values.value.id)||(this.values[t.handle].push(this.parentContainer.values.value.id),this.meta[t.handle].data=[{id:this.parentContainer.values.value.id,reference:this.parentContainer.reference.value,title:this.parentContainer.values.value.title,edit_url:this.parentContainer.values.value.edit_url}])})})})},afterActionSuccessfullyCompleted(e){e.data&&(this.title=e.data.title,this.revisionsEnabled||(this.permalink=e.data.permalink),clearTimeout(this.trackDirtyStateTimeout),this.trackDirtyState=!1,this.values=this.resetValuesFromResponse(e.data.values),this.trackDirtyStateTimeout=setTimeout(()=>this.trackDirtyState=!0,350),this.publishStatesEnabled&&(this.initialPublished=e.data.published),this.itemActions=e.data.itemActions)},redirectTo(e){le.get(e)}},mounted(){this.saveKeyBinding=this.$keys.bindGlobal(["mod+return"],e=>{e.preventDefault(),!this.confirmingPublish&&this.save()}),this.quickSaveKeyBinding=this.$keys.bindGlobal(["mod+s"],e=>{e.preventDefault(),!this.confirmingPublish&&(this.quickSave=!0,this.save())}),this.isRoot||this.populateBelongsToRelationship()},created(){window.history.replaceState({},document.title,document.location.href.replace("created=true",""))},unmounted(){clearTimeout(this.trackDirtyStateTimeout)},destroyed(){this.saveKeyBinding.destroy(),this.quickSaveKeyBinding.destroy()}},Ut={class:"flex items-center gap-3"},Ht={class:"space-y-6"},Lt={key:0},Vt={key:0,class:"flex flex-wrap gap-4"};function Ot(e,i,t,g,r,n){const R=o("StatusIndicator"),y=o("Button"),v=o("DropdownItem"),p=o("DropdownSeparator"),h=o("DropdownMenu"),b=o("Dropdown"),B=o("ItemActions"),H=o("ui-badge"),d=o("save-button-options"),m=o("Header"),E=o("PublishComponents"),I=o("Heading"),x=o("Switch"),k=o("Panel"),L=o("PanelHeader"),T=o("Icon"),A=o("Subheading"),O=o("Card"),W=o("PublishTabs"),_=o("LivePreview"),be=o("PublishContainer"),ge=o("revision-history"),pe=o("Stack"),ye=o("publish-actions");return a(),S("div",null,[s(m,null,{title:l(()=>[n.publishStatesEnabled&&!t.isCreating?(a(),u(R,{key:0,status:r.status},null,8,["status"])):c("",!0),D(" "+w(n.formattedTitle),1)]),default:l(()=>[!t.isCreating&&e.hasItemActions?(a(),u(B,{key:0,item:r.values.id,url:e.itemActionUrl,actions:e.itemActions,"is-dirty":n.isDirty,onStarted:e.actionStarted,onCompleted:e.actionCompleted},{default:l(({actions:C})=>[t.canEditBlueprint||e.hasItemActions?(a(),u(b,{key:0},{trigger:l(()=>[s(y,{icon:"dots",variant:"ghost","aria-label":e.__("Open dropdown menu")},null,8,["aria-label"])]),default:l(()=>[s(h,null,{default:l(()=>[t.canEditBlueprint?(a(),u(v,{key:0,text:e.__("Edit Blueprint"),icon:"blueprint-edit",href:r.actions.editBlueprint},null,8,["text","href"])):c("",!0),t.canEditBlueprint&&C.length?(a(),u(p,{key:1})):c("",!0),(a(!0),S(U,null,re(C,q=>(a(),u(v,{key:q.handle,text:e.__(q.title),icon:q.icon,variant:q.dangerous?"destructive":"default",onClick:q.run},null,8,["text","icon","variant","onClick"]))),128))]),_:2},1024)]),_:2},1024)):c("",!0)]),_:1},8,["item","url","actions","is-dirty","onStarted","onCompleted"])):c("",!0),r.readOnly?(a(),u(H,{key:1,icon:"padlock-locked",text:e.__("Read Only")},null,8,["text"])):c("",!0),P("div",Ut,[r.readOnly?c("",!0):(a(),u(d,{key:0,"show-options":!t.revisionsEnabled&&!t.isInline,"preferences-prefix":r.preferencesPrefix},{default:l(()=>[s(y,{disabled:!n.canSave,variant:t.revisionsEnabled?"default":"primary",onClick:G(n.save,["prevent"]),textContent:w(n.saveText)},null,8,["disabled","variant","onClick","textContent"])]),_:1},8,["show-options","preferences-prefix"])),t.revisionsEnabled&&!t.isCreating?(a(),u(d,{key:1,"show-options":!t.isInline,"preferences-prefix":r.preferencesPrefix},{default:l(()=>[s(y,{variant:"primary",disabled:!n.canPublish,onClick:i[0]||(i[0]=C=>r.confirmingPublish=!0),text:n.publishButtonText},null,8,["disabled","text"])]),_:1},8,["show-options","preferences-prefix"])):c("",!0)]),Ce(e.$slots,"action-buttons-right")]),_:3}),r.blueprint?(a(),u(be,{key:0,ref:"container",name:t.publishContainer,reference:t.initialReference,blueprint:r.blueprint,modelValue:r.values,"onUpdate:modelValue":i[4]||(i[4]=C=>r.values=C),meta:r.meta,errors:n.errors,"track-dirty-state":r.trackDirtyState,"remember-tab":!t.isInline},{default:l(()=>[s(_,{enabled:r.isPreviewing,url:t.livePreviewUrl,targets:t.previewTargets,onOpened:n.openLivePreview,onClosed:n.closeLivePreview},{buttons:l(()=>[r.readOnly?c("",!0):(a(),u(y,{key:0,size:"sm",variant:t.revisionsEnabled?"default":"primary",disabled:!n.canSave,onClick:G(n.save,["prevent"]),text:n.saveText},null,8,["variant","disabled","onClick","text"])),t.revisionsEnabled?(a(),u(y,{key:1,size:"sm",variant:"primary",disabled:!n.canPublish,onClick:i[3]||(i[3]=C=>r.confirmingPublish=!0),text:n.publishButtonText},null,8,["disabled","text"])):c("",!0)]),default:l(()=>[s(E),s(W,null,K({_:2},[t.resourceHasRoutes||n.publishStatesEnabled||t.revisionsEnabled?{name:"actions",fn:l(()=>[P("div",Ht,[t.resourceHasRoutes?(a(),S("div",Lt,[n.showLivePreviewButton||n.showVisitUrlButton?(a(),S("div",Vt,[n.showLivePreviewButton?(a(),u(y,{key:0,text:e.__("Live Preview"),class:"flex-1",icon:"live-preview",onClick:n.openLivePreview},null,8,["text","onClick"])):c("",!0),n.showVisitUrlButton?(a(),u(y,{key:1,href:r.permalink,text:e.__("Visit URL"),class:"flex-1",icon:"external-link",target:"_blank"},null,8,["href","text"])):c("",!0)])):c("",!0)])):c("",!0),n.publishStatesEnabled&&!t.revisionsEnabled?(a(),u(k,{key:1,class:"flex justify-between px-5 py-3"},{default:l(()=>[s(I,{text:e.__("Published")},null,8,["text"]),s(x,{"model-value":n.published,"read-only":!t.canManagePublishState,"onUpdate:modelValue":i[1]||(i[1]=C=>n.setFieldValue("published",C))},null,8,["model-value","read-only"])]),_:1})):c("",!0),t.revisionsEnabled&&!t.isCreating?(a(),u(k,{key:2},{default:l(()=>[s(L,{class:"flex items-center justify-between"},{default:l(()=>[s(I,{text:e.__("Revisions")},null,8,["text"]),s(y,{onClick:i[2]||(i[2]=C=>r.showRevisionHistory=!0),icon:"history",text:e.__("View History"),size:"xs",class:"-me-4"},null,8,["text"])]),_:1}),s(O,{class:"space-y-2"},{default:l(()=>[n.published?(a(),u(A,{key:0,class:"flex items-center gap-2"},{default:l(()=>[s(T,{name:"checkmark",class:"text-green-600"}),D(" "+w(e.__("Model has a published version")),1)]),_:1})):(a(),u(A,{key:1,class:"flex items-center gap-2 text-yellow-600"},{default:l(()=>[s(T,{name:"warning-diamond"}),D(" "+w(e.__("Model has not been published")),1)]),_:1})),!r.isWorkingCopy&&n.published?(a(),u(A,{key:2,class:"flex items-center gap-2"},{default:l(()=>[s(T,{name:"checkmark",class:"text-green-600"}),D(" "+w(e.__("This is the published version")),1)]),_:1})):c("",!0),n.isDirty?(a(),u(A,{key:3,class:"flex items-center gap-2 text-yellow-600"},{default:l(()=>[s(T,{name:"warning-diamond"}),D(" "+w(e.__("Unsaved changes")),1)]),_:1})):c("",!0)]),_:1})]),_:1})):c("",!0)])]),key:"0"}:void 0]),1024)]),_:1},8,["enabled","url","targets","onOpened","onClosed"])]),_:1},8,["name","reference","blueprint","modelValue","meta","errors","track-dirty-state","remember-tab"])):c("",!0),s(pe,{ref:"revisionHistoryStack",size:"narrow",title:e.__("Revision History"),open:r.showRevisionHistory,"onUpdate:open":i[6]||(i[6]=C=>r.showRevisionHistory=C)},{default:l(()=>[s(ge,{"index-url":r.actions.revisions,"restore-url":r.actions.restore,reference:t.initialReference,"can-restore-revisions":!r.readOnly,onClosed:i[5]||(i[5]=C=>e.$refs.revisionHistoryStack.close())},null,8,["index-url","restore-url","reference","can-restore-revisions"])]),_:1},8,["title","open"]),r.confirmingPublish?(a(),u(ye,{key:1,actions:r.actions,published:n.published,collection:e.collectionHandle,reference:t.initialReference,"publish-container":t.publishContainer,"can-manage-publish-state":t.canManagePublishState,onClosed:i[7]||(i[7]=C=>r.confirmingPublish=!1),onSaving:i[8]||(i[8]=C=>n.saving=!0),onSaved:n.publishActionCompleted,onFailed:n.publishActionFailed},null,8,["actions","published","collection","reference","publish-container","can-manage-publish-state","onSaved","onFailed"])):c("",!0)])}const $=Y(It,[["render",Ot]]),qt={__name:"Create",props:["actions","resource","resourceHasRoutes","title","blueprint","values","meta","canEditBlueprint","canManagePublishState","createAnotherUrl","listingUrl"],setup(e){function i(t){le.get(t.data.data.edit_url+"?created=true")}return(t,g)=>(a(),S(U,null,[s(f(X),{title:e.title},null,8,["title"]),s($,{"is-creating":!0,"publish-container":"base","initial-actions":e.actions,method:"post",resource:e.resource,"resource-has-routes":e.resourceHasRoutes,"initial-title":e.title,"initial-blueprint":e.blueprint,"initial-values":e.values,"initial-meta":e.meta,"can-edit-blueprint":e.canEditBlueprint,"can-manage-publish-state":e.canManagePublishState,"create-another-url":e.createAnotherUrl,"initial-listing-url":e.listingUrl,onSaved:i},null,8,["initial-actions","resource","resource-has-routes","initial-title","initial-blueprint","initial-values","initial-meta","can-edit-blueprint","can-manage-publish-state","create-another-url","initial-listing-url"])],64))}},Ft={__name:"Edit",props:["actions","method","resource","resourceHasRoutes","title","reference","status","blueprint","values","meta","permalink","hasWorkingCopy","revisionsEnabled","readOnly","canEditBlueprint","canManagePublishState","createAnotherUrl","listingUrl","itemActions","itemActionUrl","livePreviewUrl","previewTargets"],setup(e){return(i,t)=>(a(),S(U,null,[s(f(X),{title:e.title},null,8,["title"]),s($,{"publish-container":"base","initial-actions":e.actions,method:e.method,resource:e.resource,"resource-has-routes":e.resourceHasRoutes,"initial-title":e.title,"initial-reference":e.reference,"initial-status":e.status,"initial-blueprint":e.blueprint,"initial-values":e.values,"initial-meta":e.meta,"initial-permalink":e.permalink,"initial-is-working-copy":e.hasWorkingCopy,"revisions-enabled":e.revisionsEnabled,"initial-read-only":e.readOnly,"can-edit-blueprint":e.canEditBlueprint,"can-manage-publish-state":e.canManagePublishState,"create-another-url":e.createAnotherUrl,"initial-listing-url":e.listingUrl,"initial-item-actions":e.itemActions,"item-action-url":e.itemActionUrl,"live-preview-url":e.livePreviewUrl,"preview-targets":e.previewTargets},null,8,["initial-actions","method","resource","resource-has-routes","initial-title","initial-reference","initial-status","initial-blueprint","initial-values","initial-meta","initial-permalink","initial-is-working-copy","revisions-enabled","initial-read-only","can-edit-blueprint","can-manage-publish-state","create-another-url","initial-listing-url","initial-item-actions","item-action-url","live-preview-url","preview-targets"])],64))}},zt={class:"mb-1.5 last:mb-0"},jt={__name:"Item",props:{item:Object,config:Object,statusIcon:Boolean,editable:Boolean,sortable:Boolean,readOnly:Boolean,formComponent:String,formComponentProps:Object,formStackSize:String},emits:["removed"],setup(e,{emit:i}){const{meta:t}=Ye(),g=Se(),r=i,n=M(!1),R=V(()=>{var h,b;const p=((h=g.parent.parent.props.fieldPathKeys)==null?void 0:h.join("."))||g.parent.parent.props.handle;return(b=data_get(t,p))==null?void 0:b.unlinkBehavior});function y(){if(R.value==="delete"){n.value=!0;return}r("removed")}function v(){n.value=!1,r("removed")}return(p,h)=>(a(),S("div",zt,[s(f(Be),_e(p.$props,{onRemoved:y}),null,16),s(f(qe),{open:n.value,title:p.__("Unlink"),"body-text":p.__("Unlinking this model will result in it being deleted. Are you sure you want to do this?"),"button-text":p.__("Delete"),danger:!0,onConfirm:v,onCancel:h[0]||(h[0]=b=>n.value=!1)},null,8,["open","title","body-text","button-text"])]))}},Wt={class:"px-4 py-3"},Nt={class:"flex items-center gap-2"},Gt={__name:"Widget",props:{additionalColumns:Array,resource:String,icon:String,title:String,initialPerPage:{type:Number,default:5},initialSortColumn:{type:String},initialSortDirection:{type:String},titleColumn:String,hasPublishStates:Boolean,canCreate:Boolean,listingUrl:String},setup(e){const i=e,t=M(cp_url(`runway/${i.resource}/listing-api`)),g=V(()=>[{field:i.titleColumn,visible:!0},...i.additionalColumns]),r=V(()=>({title:i.title,icon:i.icon}));return(n,R)=>{const y=o("ui-description"),v=o("ui-button");return a(),u(f(fe),{url:t.value,columns:g.value,"per-page":e.initialPerPage,"show-pagination-totals":!1,"show-pagination-page-links":!1,"show-pagination-per-page-selector":!1,"sort-column":e.initialSortColumn,"sort-direction":e.initialSortDirection},{initializing:l(()=>[s(f(ne),te(ee(r.value)),{default:l(()=>[s(f(Z),{name:"loading"})]),_:1},16)]),default:l(({items:p,loading:h})=>[s(f(ne),te(ee(r.value)),{actions:l(()=>[s(f(je)),e.canCreate?(a(),u(v,{key:0,href:e.listingUrl},{default:l(()=>[D(w(n.__("View All")),1)]),_:1},8,["href"])):c("",!0)]),default:l(()=>[p.length?c("",!0):(a(),u(y,{key:0,class:"flex-1 flex items-center justify-center"},{default:l(()=>[D(w(n.__("There are no models in this resource")),1)]),_:1})),P("div",Wt,[P("table",{class:N(["w-full [&_td]:p-0.5 [&_td]:text-sm",{"opacity-50":h}])},[s(f(Ne),{"sr-only":""}),s(f(We),null,K({[`cell-${e.titleColumn}`]:l(({row:b,isColumnVisible:B})=>[P("div",Nt,[e.hasPublishStates&&!B("status")?(a(),u(f(z),{key:0,status:b.status},null,8,["status"])):c("",!0),s(f(ae),{href:b.edit_url,class:"line-clamp-1 overflow-hidden text-ellipsis",textContent:w(b[e.titleColumn])},null,8,["href","textContent"])])]),_:2},[e.hasPublishStates?{name:"cell-status",fn:l(({row:b})=>[s(f(z),{status:b.status,"show-dot":!1,"show-label":""},null,8,["status"])]),key:"0"}:void 0]),1024)],2)])]),_:2},1040)]),_:1},8,["url","columns","per-page","sort-column","sort-direction"])}}};Statamic.booting(()=>{Statamic.$inertia.register("runway::Index",rt),Statamic.$inertia.register("runway::Create",qt),Statamic.$inertia.register("runway::Edit",Ft),Statamic.$components.register("runway-related-item",jt),Statamic.$components.register("runway-publish-form",$),Statamic.$components.register("runway-widget",Gt)});
